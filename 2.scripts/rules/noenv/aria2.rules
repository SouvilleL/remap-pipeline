rule aria2:
    """
    This rule downloads from an url a fastq.gz file and checks the md5
    It does not check the date stamp of the input file

    Required parameters:
        None

    Author: Jeanne Ch√®neby
    """

	input:
			lambda wildcards : ancient(expand( os.path.join( TAB_DIR,  "{tab_filename}"), tab_filename = dict_fastq_info[ wildcards.fastq_name][ "experimentName"]))
	output:
			temp( os.path.join( PREPROCESSING_DIR, "raw_fastq", "{fastq_name}.fastq.gz"))
	singularity:
			config[ "singularity"][ "aria2"]
	resources:
			res=12,
			mem_mb=5000,
			disk_mb=10000,
			tmpdir=os.path.join(PREPROCESSING_DIR,"TEMP")
	log:
			os.path.join( PREPROCESSING_DIR, "raw_fastq", "log", "{fastq_name}.log")
	params:
			url = lambda wildcards : dict_fastq_info[ wildcards.fastq_name][ 'url'],
			md5 = lambda wildcards : dict_fastq_info[ wildcards.fastq_name][ 'md5']
	shell: 
		"""
		aria2c  --file-allocation=prealloc --disable-ipv6 -l {log} --out={output} --checksum=md5={params.md5} {params.url}
		"""
